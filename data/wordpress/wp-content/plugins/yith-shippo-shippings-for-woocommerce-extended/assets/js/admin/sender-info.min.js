jQuery((function(e){var t={onboardingValidation:!0,template:void 0!==wp.template?wp.template("yith-shippo-sender"):null,modal:!1,selector:{addSenderButton:e(document).find("button.yith-shippo-add-sender"),mainButton:"#yith-plugin-fw__panel__content__save",mainBox:".single-sender-info-wrapper",mainForm:"#plugin-fw-wc",editSender:".action__edit",deleteSender:".action__trash",setDefault:".set-default"},initFields:function(){"undefined"!=typeof selectWoo&&e("#yith-shippo-sender-info-country_state").selectWoo()},init:function(){this.initFields(),e(document).on("submit","#plugin-fw-wc",(function(){return!1})),this.selector.addSenderButton.length>0&&e(document).find("h1").append(this.selector.addSenderButton),e("table#sender-info").length>0&&e("p.submit, #yith-plugin-fw-float-save-button, #plugin-fw-wc-reset").hide(),e(document).on("change","#yith-shippo-sender-use_wc_address",this.fillAddress),e(document).find("#yith-shippo-sender-use_wc_address").change(),e(document).on("click",this.selector.mainButton,this.validateSenderInfo),e(document).on("click",".yith-plugin-fw__modal__main #yith-shippo-save-sender",this.validateSenderInfo),e(document).on("click","button.yith-shippo-add-sender",this.addSender),e(document).on("click",this.selector.editSender,this.editSender),e(document).on("click",this.selector.deleteSender,this.deleteSender),e(document).on("click",this.selector.setDefault,this.setDefault),e(document).on("yith_onboarding_form_submit_validation",this.onboardingNeedValidation.bind(this)),e(document).on("yith_onboarding_validate_form_submit",this.onboardingValidate.bind(this))},onboardingNeedValidation:function(){return this.onboardingValidation},onboardingValidate:function(i,n){var o=t.checkEmptyFields();if(!o)var a=this.checkValidEmail(e("#yith-shippo-sender-info-email"));!o&&a&&(this.onboardingValidation=!1,n.submit())},block:function(e){e.block({message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}})},unblock:function(e){e.unblock()},fillAddress:function(i){if(i.preventDefault(),i.stopImmediatePropagation(),e(document).find("#yith-shippo-sender-use_wc_address").is(":checked")){var n=yith_shippo_sender_info_params.woocommerce_shop_base_info;for(var o in n)e(document).find("#yith-shippo-sender-info-"+o).val(n[o]).attr("disabled",!0).change()}else e(document).find(".yith-shippo-sender-wrap input",".yith-shippo-sender-wrap select").attr("disabled",!1),e(document).find(".yith-shippo-sender-wrap select").attr("disabled",!1);t.initFields()},checkEmptyFields:function(){var t=!1;return document.querySelectorAll(".yith-shippo-validate").forEach((function(i){let n=e(i).closest(".yith-single-text").find(".empty-field");""===e(i).val()?(t=!0,n.length||e("<span class='empty-field description'>"+yith_shippo_sender_info_params.emptyField+"</span>").insertAfter(e(i)),n.show(),e(i).addClass("is-empty")):(n.hide(),e(i).removeClass("is-empty"))})),t},checkValidEmail:function(t){var i=!1;return e(t).val().match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/)?i=!0:e("<span class='empty-field description'>"+yith_shippo_sender_info_params.invalidEmailField+"</span>").insertAfter(e(t)),i},validateSenderInfo:function(i){i.preventDefault(),i.stopImmediatePropagation();var n=t.checkEmptyFields(e(".yith-shippo-validate"));if(!n)var o=t.checkValidEmail(e("#yith-shippo-sender-info-email"));if(n||!o)return!1;var a=e(t.selector.mainBox),s=e(t.selector.mainForm);t.modal&&(s=a=e(document).find("#yith-shippo-sender-info-modal form")),t.block(a);var d=new FormData,r=s.serializeArray();e.each(r,(function(e,t){d.append(t.name,t.value)})),d.append("action",yith_shippo_sender_info_params.actions.validateSenderInfo),d.append("security",yith_shippo_sender_info_params.security.addSenderInfoNonce);var l=e("#yith-bh-onboarding").length>0;e.ajax({type:"POST",data:d,dataType:"json",contentType:!1,processData:!1,url:yith_shippo_sender_info_params.ajaxurl,success:function(i){if(i.success){if(l)return!0;t.modal?(e(document).find(".yith-shippo-sender-info").html(i.data),t.modal.close()):e(document).find(".yith-shippo-address-validation-error").html(i.data).removeClass("error").addClass("success")}else i.data&&e(document).find(".yith-shippo-address-validation-error").html(i.data).removeClass("success").addClass("error")},complete:function(){t.unblock(a)}})},addSender:function(i){i.preventDefault(),i.stopImmediatePropagation();var n=e(t.template({id:"shippo-"+Date.now(),edit:!1}));t.modal=yith.ui.modal({content:n,title:yith_shippo_sender_info_params.modal_title,width:510}),e("#yith-shippo-sender-info-shipping_zones input").attr("checked",!1),t.initFields()},editSender:function(i){i.preventDefault(),i.stopImmediatePropagation();var n=e(this).closest(".yith-shippo-sender-info"),o=n.data("item"),a=o.shipping_zones;o.edit=!0,o.id=n.data("id");var s=e(t.template(o)),d=s.find(".yith-plugin-fw-checkbox-array__row"),r=s.find(".yith-shipping-zone-select-all input");r.attr("checked",!1),d.each((function(){var t=e(this).find("input");t.attr("checked",!1),e(this).removeClass("selected");var i=t.val();for(var n of a)n===i&&(t.attr("checked",!0),e(this).addClass("selected"))})),d.length===a.length&&r.attr("checked",!0),t.modal=yith.ui.modal({content:s,title:yith_shippo_sender_info_params.modal_title,width:510}),e(document).find("#yith-shippo-sender-info-country_state").val(o.country_state),t.initFields()},deleteSender:function(i){i.preventDefault();var n=e("#sender-info"),o=e(this).closest("tr").data("id");yith.ui.confirm({title:yith_shippo_sender_info_params.delete_confirmation_title,message:yith_shippo_sender_info_params.delete_confirmation_message,confirmButtonType:"delete",closeAfterConfirm:!0,onConfirm:function(){t.block(n),e.ajax({type:"POST",url:yith_shippo_sender_info_params.ajaxurl,data:{id:o,security:yith_shippo_sender_info_params.security.deleteSenderInfoNonce,action:yith_shippo_sender_info_params.actions.deleteSenderInfo},success:function(t){t.success&&void 0!==t.data&&e(document).find(".yith-shippo-sender-info").html(t.data),void 0!==t.error&&console.log(t.error)}})}})},setDefault:function(i){i.preventDefault();var n=e("#sender-info"),o=e(this).closest("tr").data("id");t.block(n),e.ajax({type:"POST",url:yith_shippo_sender_info_params.ajaxurl,data:{id:o,security:yith_shippo_sender_info_params.security.setDefaultSenderInfoNonce,action:yith_shippo_sender_info_params.actions.setDefaultSenderInfo},success:function(t){t.success&&void 0!==t.data&&e(document).find(".yith-shippo-sender-info").html(t.data),void 0!==t.error&&console.log(t.error)}})}};t.init()}));